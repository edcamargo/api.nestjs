name: Branch Naming Check

on:
  push:
    branches:
      - '**'
  pull_request:
    branches:
      - develop
      - main

jobs:
  check-branch-name:
    name: Validate Branch Name
    runs-on: ubuntu-latest
    
    steps:
      - name: Check branch naming convention
        run: |
          echo "Checking branch name: ${{ github.ref_name }}"
          
          # Allow develop and main
          if [[ "${{ github.ref_name }}" == "develop" ]] || [[ "${{ github.ref_name }}" == "main" ]]; then
            echo "‚úÖ Main branch detected"
            exit 0
          fi
          
          # Check if branch follows naming convention
          if [[ "${{ github.ref_name }}" =~ ^(feature|bugfix|hotfix)/.+ ]]; then
            echo "‚úÖ Branch name '${{ github.ref_name }}' follows the naming convention"
            exit 0
          else
            echo "‚ùå Branch name '${{ github.ref_name }}' does not follow the naming convention!"
            echo ""
            echo "üìã Required patterns:"
            echo "  - feature/<description>  (for new features)"
            echo "  - bugfix/<description>   (for bug fixes)"
            echo "  - hotfix/<description>   (for urgent production fixes)"
            echo ""
            echo "Examples:"
            echo "  ‚úÖ feature/user-authentication"
            echo "  ‚úÖ bugfix/fix-login-error"
            echo "  ‚úÖ hotfix/critical-security-patch"
            echo ""
            echo "‚ùå Invalid: my-branch, test, cicd"
            exit 1
          fi

      - name: Success message
        if: success()
        run: |
          echo "üéâ Branch naming convention check passed!"
          echo "Branch: ${{ github.ref_name }}"
